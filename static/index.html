<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Transcription Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .recording-pulse {
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
        }

        .wave-animation {
            animation: wave 1.5s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .typing-effect::after {
            content: '|';
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .accuracy-meter {
            position: relative;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
        }

        .accuracy-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }

        .floating-element {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .neon-glow {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .statement-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .statement-card:hover {
            border-left-color: #6366f1;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .waveform {
            display: flex;
            align-items: center;
            gap: 2px;
            height: 40px;
        }

        .wave-bar {
            width: 3px;
            background: linear-gradient(to top, #6366f1, #8b5cf6);
            border-radius: 2px;
            animation: wave-bars 1s ease-in-out infinite;
        }

        @keyframes wave-bars {
            0%, 100% { height: 10px; }
            50% { height: 30px; }
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            stroke-dasharray: 251.2;
            stroke-dashoffset: 251.2;
            transition: stroke-dashoffset 0.5s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100">
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="floating-element absolute top-20 left-20 w-32 h-32 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full opacity-10"></div>
        <div class="floating-element absolute top-40 right-32 w-24 h-24 bg-gradient-to-r from-pink-400 to-red-400 rounded-full opacity-10" style="animation-delay: -1s;"></div>
        <div class="floating-element absolute bottom-32 left-1/4 w-40 h-40 bg-gradient-to-r from-green-400 to-blue-400 rounded-full opacity-10" style="animation-delay: -2s;"></div>
    </div>

    <div class="relative z-10 max-w-6xl mx-auto p-6">
        <header class="text-center mb-12">
            <div class="mb-6">
                <h1 class="text-6xl font-bold gradient-text mb-4">Speech-To-Text</h1>
            </div>

            <div class="glass-card rounded-2xl p-6 mx-auto max-w-md">
                <div class="flex items-center justify-center gap-4">
                    <div class="relative">
                        <div id="status-dot" class="w-4 h-4 rounded-full bg-red-500 transition-colors duration-300"></div>
                        <div id="status-pulse" class="absolute inset-0 w-4 h-4 rounded-full bg-red-500 opacity-30 hidden"></div>
                    </div>
                    <div class="text-center">
                        <div id="status-text" class="text-lg font-semibold text-gray-700">Connecting...</div>
                        <div id="status-detail" class="text-sm text-gray-500">Initializing WebSocket connection</div>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex justify-center mb-8">
            <div class="glass-card rounded-2xl p-2 shadow-xl">
                <div class="flex gap-2">
                    <button id="live-tab" class="px-8 py-4 rounded-xl font-semibold transition-all duration-300 bg-white text-indigo-600 shadow-lg neon-glow">
                        <div class="flex items-center gap-3">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                            Live Transcription
                        </div>
                    </button>
                    <button id="test-tab" class="px-8 py-4 rounded-xl font-semibold transition-all duration-300 text-gray-600 hover:text-indigo-600 hover:bg-white/50">
                        <div class="flex items-center gap-3">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 12l2 2 4-4"/>
                                <path d="M21 12c.552 0 1-.448 1-1V8c0-.552-.448-1-1-1s-1 .448-1 1v3c0 .552.448 1 1 1z"/>
                                <path d="M3 12c-.552 0-1-.448-1-1V8c0-.552.448-1 1-1s1 .448 1 1v3c0 .552-.448 1-1 1z"/>
                                <rect x="3" y="4" width="18" height="16" rx="2"/>
                            </svg>
                            Accuracy Testing
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <div id="live-content" class="space-y-8">
            <div class="glass-card rounded-3xl p-8 card-hover transition-all duration-300">
                <div class="text-center">
                    <div class="mb-8">
                        <div class="relative inline-block">
                            <button id="record-btn" class="relative w-32 h-32 rounded-full transition-all duration-300 shadow-2xl bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg id="mic-icon" class="w-12 h-12 mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                    <line x1="12" y1="19" x2="12" y2="23"/>
                                    <line x1="8" y1="23" x2="16" y2="23"/>
                                </svg>
                                <div id="recording-indicator" class="absolute inset-0 rounded-full hidden recording-pulse"></div>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 id="record-status" class="text-2xl font-bold text-gray-800">Click to Start Recording</h3>
                        <div id="waveform-container" class="hidden justify-center">
                            <div class="waveform">
                                <div class="wave-bar" style="animation-delay: 0ms;"></div>
                                <div class="wave-bar" style="animation-delay: 100ms;"></div>
                                <div class="wave-bar" style="animation-delay: 200ms;"></div>
                                <div class="wave-bar" style="animation-delay: 300ms;"></div>
                                <div class="wave-bar" style="animation-delay: 400ms;"></div>
                                <div class="wave-bar" style="animation-delay: 500ms;"></div>
                                <div class="wave-bar" style="animation-delay: 600ms;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-card rounded-3xl p-8 min-h-64">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-8 h-8 bg-gradient-to-r from-green-400 to-blue-500 rounded-lg flex items-center justify-center">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800">Live Transcript</h3>
                </div>
                <div class="bg-white/80 rounded-2xl p-6 min-h-32 border border-white/20">
                    <p id="live-transcript" class="text-gray-800 text-xl leading-relaxed">
                        Ready to transcribe your speech in real-time...
                    </p>
                </div>
            </div>
        </div>

        <div id="test-content" class="space-y-8 hidden">
            <div class="glass-card rounded-3xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Accuracy Testing Suite</h2>
                    <p class="text-lg text-gray-600">Test the transcription accuracy with below statements</p>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-400 to-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <polygon points="23 7 16 12 23 17 23 7"/>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                            </svg>
                        </div>
                        <h4 class="font-semibold text-gray-800">Listen</h4>
                        <p class="text-sm text-gray-600">Click the speaker icon to hear each statement</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-400 to-blue-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            </svg>
                        </div>
                        <h4 class="font-semibold text-gray-800">Record</h4>
                        <p class="text-sm text-gray-600">Speak the statement clearly into your microphone</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-400 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M9 12l2 2 4-4"/>
                                <path d="M22 12c.552 0 1-.448 1-1V8c0-.552-.448-1-1-1s-1 .448-1 1v3c0 .552-.448 1-1 1z"/>
                            </svg>
                        </div>
                        <h4 class="font-semibold text-gray-800">Analyze</h4>
                        <p class="text-sm text-gray-600">Get instant accuracy feedback and detailed analysis</p>
                    </div>
                </div>
            </div>

            <div class="glass-card rounded-3xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Test Statements</h3>
                <div id="statements-container" class="space-y-4">
                </div>
            </div>

            <div id="results-section" class="glass-card rounded-3xl p-8 hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800">Performance Analytics</h3>
                        <p class="text-gray-600">Detailed accuracy analysis of your tests</p>
                    </div>
                    <button id="clear-results" class="px-6 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors duration-300 flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Clear Results
                    </button>
                </div>
                <div id="results-container" class="space-y-6">
                </div>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let stream = null;
        let audioContext = null;
        let processor = null;
        let isConnected = false;
        let isRecording = false;
        let activeTab = 'live';
        let currentTest = null;
        let testResults = [];
        let testTranscript = '';

        const testStatements = [
            "The quick brown fox jumps over the lazy dog.",
            "Artificial intelligence is transforming the way we work and live.",
            "Machine learning algorithms can process vast amounts of data efficiently.",
            "Voice recognition technology has improved significantly in recent years.",
            "Real-time transcription enables better accessibility for hearing impaired users."
        ];

        const statusDot = document.getElementById('status-dot');
        const statusPulse = document.getElementById('status-pulse');
        const statusText = document.getElementById('status-text');
        const statusDetail = document.getElementById('status-detail');
        const liveTab = document.getElementById('live-tab');
        const testTab = document.getElementById('test-tab');
        const liveContent = document.getElementById('live-content');
        const testContent = document.getElementById('test-content');
        const recordBtn = document.getElementById('record-btn');
        const micIcon = document.getElementById('mic-icon');
        const recordingIndicator = document.getElementById('recording-indicator');
        const recordStatus = document.getElementById('record-status');
        const waveformContainer = document.getElementById('waveform-container');
        const liveTranscript = document.getElementById('live-transcript');
        const statementsContainer = document.getElementById('statements-container');
        const resultsSection = document.getElementById('results-section');
        const resultsContainer = document.getElementById('results-container');
        const clearResultsBtn = document.getElementById('clear-results');

        function init() {
            connectWebSocket();
            setupTabs();
            setupRecordButton();
            populateTestStatements();
            setupClearResults();
        }

        function connectWebSocket() {
            try {
                statusDetail.textContent = 'Establishing connection...';
                ws = new WebSocket("ws://localhost:8000/ws/audio");

                ws.onopen = () => {
                    isConnected = true;
                    updateStatus('Connected', 'Ready for transcription', true);
                    recordBtn.disabled = false;
                };

                ws.onmessage = (e) => {
                    if (activeTab === 'live') {
                        updateLiveTranscript(e.data);
                    } else if (currentTest !== null) {
                        testTranscript = e.data;
                        updateTestTranscript();
                    }
                };

                ws.onerror = (error) => {
                    updateStatus('Connection Error', 'Failed to connect to server', false);
                };

                ws.onclose = () => {
                    isConnected = false;
                    updateStatus('Disconnected', 'Connection lost', false);
                    recordBtn.disabled = true;
                };
            } catch (error) {
                updateStatus('Connection Failed', 'Unable to establish WebSocket connection', false);
            }
        }

        function updateStatus(text, detail, connected) {
            statusText.textContent = text;
            statusDetail.textContent = detail;

            if (connected) {
                statusDot.className = 'w-4 h-4 rounded-full bg-green-500 transition-colors duration-300';
                statusPulse.className = 'absolute inset-0 w-4 h-4 rounded-full bg-green-500 opacity-30 animate-ping';
                statusPulse.classList.remove('hidden');
            } else {
                statusDot.className = 'w-4 h-4 rounded-full bg-red-500 transition-colors duration-300';
                statusPulse.classList.add('hidden');
            }
        }

        function updateLiveTranscript(text) {
            liveTranscript.classList.add('typing-effect');
            liveTranscript.textContent = text;
            setTimeout(() => {
                liveTranscript.classList.remove('typing-effect');
            }, 500);
        }

        function setupTabs() {
            liveTab.addEventListener('click', () => switchTab('live'));
            testTab.addEventListener('click', () => switchTab('test'));
        }

        function switchTab(tab) {
            activeTab = tab;

            if (tab === 'live') {
                liveTab.className = 'px-8 py-4 rounded-xl font-semibold transition-all duration-300 bg-white text-indigo-600 shadow-lg neon-glow';
                testTab.className = 'px-8 py-4 rounded-xl font-semibold transition-all duration-300 text-gray-600 hover:text-indigo-600 hover:bg-white/50';
                liveContent.classList.remove('hidden');
                testContent.classList.add('hidden');
                liveContent.classList.add('fade-in');
            } else {
                liveTab.className = 'px-8 py-4 rounded-xl font-semibold transition-all duration-300 text-gray-600 hover:text-indigo-600 hover:bg-white/50';
                testTab.className = 'px-8 py-4 rounded-xl font-semibold transition-all duration-300 bg-white text-indigo-600 shadow-lg neon-glow';
                liveContent.classList.add('hidden');
                testContent.classList.remove('hidden');
                testContent.classList.add('fade-in');
            }
        }

        function setupRecordButton() {
            recordBtn.addEventListener('click', () => {
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            });
        }

        async function startRecording() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        sampleRate: 16000,
                        channelCount: 1,
                        echoCancellation: false,
                        noiseSuppression: false,
                        autoGainControl: false
                    }
                });

                audioContext = new AudioContext({ sampleRate: 16000 });
                const source = audioContext.createMediaStreamSource(stream);
                processor = audioContext.createScriptProcessor(4096, 1, 1);

                processor.onaudioprocess = (e) => {
                    const inputData = e.inputBuffer.getChannelData(0);
                    const int16Array = new Int16Array(inputData.length);

                    for (let i = 0; i < inputData.length; i++) {
                        const sample = Math.max(-1, Math.min(1, inputData[i]));
                        int16Array[i] = sample * 32767;
                    }

                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(int16Array.buffer);
                    }
                };

                source.connect(processor);
                processor.connect(audioContext.destination);

                isRecording = true;
                updateRecordButton();
                updateStatus('Recording', 'Listening to your voice...', true);

                if (activeTab === 'live') {
                    liveTranscript.textContent = 'Listening... Start speaking!';
                }
            } catch (error) {
                updateStatus('Microphone Error', 'Please allow microphone access', false);
            }
        }

        function stopRecording() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            if (processor) {
                processor.disconnect();
            }
            if (audioContext) {
                audioContext.close();
            }

            isRecording = false;
            updateRecordButton();
            updateStatus('Connected', 'Ready for transcription', true);
        }

        function updateRecordButton() {
            if (isRecording) {
                recordBtn.className = 'relative w-32 h-32 rounded-full transition-all duration-300 shadow-2xl bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white';
                recordStatus.textContent = 'Recording... Click to Stop';
                recordingIndicator.classList.remove('hidden');
                waveformContainer.classList.remove('hidden');
                waveformContainer.classList.add('flex');
                micIcon.innerHTML = `
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 6v6l4-2z"/>
                `;
            } else {
                recordBtn.className = 'relative w-32 h-32 rounded-full transition-all duration-300 shadow-2xl bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white disabled:opacity-50 disabled:cursor-not-allowed';
                recordStatus.textContent = 'Click to Start Recording';
                recordingIndicator.classList.add('hidden');
                waveformContainer.classList.add('hidden');
                waveformContainer.classList.remove('flex');
                micIcon.innerHTML = `
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                    <line x1="12" y1="19" x2="12" y2="23"/>
                    <line x1="8" y1="23" x2="16" y2="23"/>
                `;
            }
        }

        function populateTestStatements() {
            testStatements.forEach((statement, index) => {
                const statementDiv = document.createElement('div');
                statementDiv.className = 'statement-card glass-card rounded-2xl p-6 slide-in';
                statementDiv.style.animationDelay = `${index * 100}ms`;
                statementDiv.innerHTML = `
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-indigo-400 to-purple-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                                    ${index + 1}
                                </div>
                                <span class="text-sm font-medium text-gray-500">Test Statement</span>
                            </div>
                            <p class="text-gray-800 text-lg leading-relaxed mb-4">${statement}</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="speakText('${statement.replace(/'/g, "\\'")}')" class="w-12 h-12 bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-xl hover:from-blue-500 hover:to-blue-700 transition-all duration-300 flex items-center justify-center shadow-lg" title="Listen to statement">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="11 5,6 9,2 9,2 15,6 15,11 19"/>
                                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                                </svg>
                            </button>
                            <button id="test-btn-${index}" onclick="startTest(${index})" class="px-6 py-3 bg-gradient-to-r from-green-400 to-green-600 text-white rounded-xl hover:from-green-500 hover:to-green-700 transition-all duration-300 font-semibold shadow-lg">
                                Test Now
                            </button>
                        </div>
                    </div>
                    <div id="test-area-${index}" class="mt-6 space-y-4 hidden">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                            <polyline points="14,2 14,8 20,8"/>
                                        </svg>
                                    </div>
                                    <span class="text-sm font-semibold text-blue-800">Original Statement</span>
                                </div>
                                <p class="text-blue-900 font-medium">${statement}</p>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                        </svg>
                                    </div>
                                    <span class="text-sm font-semibold text-green-800">Your Transcription</span>
                                </div>
                                <p id="test-transcript-${index}" class="text-green-900 font-medium">Listening... Please speak clearly</p>
                            </div>
                        </div>
                        <div class="flex justify-center">
                            <button onclick="endTest()" class="px-8 py-3 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-xl hover:from-purple-600 hover:to-purple-800 transition-all duration-300 font-semibold shadow-lg flex items-center gap-2">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 11 12 14 22 4"/>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                                </svg>
                                Complete Test
                            </button>
                        </div>
                    </div>
                `;
                statementsContainer.appendChild(statementDiv);
            });
        }

        function startTest(index) {
            currentTest = index;
            testTranscript = '';

            testStatements.forEach((_, i) => {
                const testArea = document.getElementById(`test-area-${i}`);
                const testBtn = document.getElementById(`test-btn-${i}`);
                if (i === index) {
                    testArea.classList.remove('hidden');
                    testArea.classList.add('slide-in');
                    testBtn.innerHTML = `
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-white rounded-full animate-pulse"></div>
                            Recording...
                        </div>
                    `;
                    testBtn.className = 'px-6 py-3 bg-gradient-to-r from-red-400 to-red-600 text-white rounded-xl font-semibold shadow-lg cursor-default';
                } else {
                    testArea.classList.add('hidden');
                    testBtn.textContent = 'Test Now';
                    testBtn.className = 'px-6 py-3 bg-gradient-to-r from-green-400 to-green-600 text-white rounded-xl hover:from-green-500 hover:to-green-700 transition-all duration-300 font-semibold shadow-lg';
                }
            });

            if (!isRecording) {
                startRecording();
            }
        }

        function endTest() {
            if (currentTest !== null && testTranscript.trim()) {
                const accuracy = calculateAccuracy(testStatements[currentTest], testTranscript);
                const result = {
                    statement: testStatements[currentTest],
                    transcription: testTranscript,
                    accuracy: accuracy,
                    timestamp: new Date().toLocaleTimeString(),
                    date: new Date().toLocaleDateString()
                };
                testResults.unshift(result);
                updateTestResults();

                showTestCompleteAnimation(accuracy);
            }

            const testArea = document.getElementById(`test-area-${currentTest}`);
            const testBtn = document.getElementById(`test-btn-${currentTest}`);
            testArea.classList.add('hidden');
            testBtn.textContent = 'Test Now';
            testBtn.className = 'px-6 py-3 bg-gradient-to-r from-green-400 to-green-600 text-white rounded-xl hover:from-green-500 hover:to-green-700 transition-all duration-300 font-semibold shadow-lg';

            currentTest = null;
            testTranscript = '';
        }

        function showTestCompleteAnimation(accuracy) {
            const color = accuracy >= 80 ? 'green' : accuracy >= 60 ? 'yellow' : 'red';
            const message = accuracy >= 80 ? 'Excellent!' : accuracy >= 60 ? 'Good!' : 'Keep practicing!';

            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-6 bg-gradient-to-r from-${color}-400 to-${color}-600 text-white px-6 py-4 rounded-xl shadow-2xl z-50 slide-in`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 11 12 14 22 4"/>
                        </svg>
                    </div>
                    <div>
                        <div class="font-bold">${message}</div>
                        <div class="text-sm opacity-90">${accuracy}% Accuracy</div>
                    </div>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function updateTestTranscript() {
            if (currentTest !== null) {
                const transcriptElement = document.getElementById(`test-transcript-${currentTest}`);
                transcriptElement.textContent = testTranscript || 'Listening... Please speak clearly';
            }
        }

        function calculateAccuracy(original, transcribed) {
            const originalWords = original.toLowerCase().split(' ');
            const transcribedWords = transcribed.toLowerCase().split(' ');

            let matchingWords = 0;

            originalWords.forEach(word => {
                if (transcribedWords.includes(word)) {
                    matchingWords++;
                }
            });

            return Math.round((matchingWords / originalWords.length) * 100);
        }

        function updateTestResults() {
            if (testResults.length > 0) {
                resultsSection.classList.remove('hidden');
                resultsSection.classList.add('slide-in');
                resultsContainer.innerHTML = '';

                const avgAccuracy = Math.round(testResults.reduce((sum, result) => sum + result.accuracy, 0) / testResults.length);

                const summaryCard = document.createElement('div');
                summaryCard.className = 'glass-card rounded-2xl p-6 mb-6';
                summaryCard.innerHTML = `
                    <div class="grid md:grid-cols-3 gap-6 text-center">
                        <div>
                            <div class="text-3xl font-bold text-indigo-600">${testResults.length}</div>
                            <div class="text-sm text-gray-600">Tests Completed</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-green-600">${avgAccuracy}%</div>
                            <div class="text-sm text-gray-600">Average Accuracy</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-purple-600">${testResults.filter(r => r.accuracy >= 80).length}</div>
                            <div class="text-sm text-gray-600">Excellent Scores</div>
                        </div>
                    </div>
                `;
                resultsContainer.appendChild(summaryCard);

                testResults.forEach((result, index) => {
                    const accuracyColor = result.accuracy >= 80 ? 'green' :
                                         result.accuracy >= 60 ? 'yellow' : 'red';

                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'glass-card rounded-2xl p-6 slide-in';
                    resultDiv.style.animationDelay = `${index * 50}ms`;
                    resultDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="text-sm text-gray-500">${result.date} at ${result.timestamp}</div>
                                <div class="text-lg font-semibold text-gray-800 mt-1">Test Result #${testResults.length - index}</div>
                            </div>
                            <div class="text-right">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="accuracy-meter w-24">
                                        <div class="accuracy-fill bg-gradient-to-r from-${accuracyColor}-400 to-${accuracyColor}-600" style="width: ${result.accuracy}%"></div>
                                    </div>
                                    <span class="text-2xl font-bold text-${accuracyColor}-600">${result.accuracy}%</span>
                                </div>
                                <div class="text-sm text-gray-500">Accuracy Score</div>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-gray-50 rounded-xl p-4">
                                <div class="text-sm font-semibold text-gray-600 mb-2">Original Statement</div>
                                <p class="text-gray-800 leading-relaxed">${result.statement}</p>
                            </div>
                            <div class="bg-blue-50 rounded-xl p-4">
                                <div class="text-sm font-semibold text-blue-600 mb-2">Your Transcription</div>
                                <p class="text-blue-800 leading-relaxed">${result.transcription}</p>
                            </div>
                        </div>
                    `;
                    resultsContainer.appendChild(resultDiv);
                });
            } else {
                resultsSection.classList.add('hidden');
            }
        }

        function setupClearResults() {
            clearResultsBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all test results?')) {
                    testResults = [];
                    updateTestResults();
                }
            });
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 0.8;

                const voices = speechSynthesis.getVoices();
                const preferredVoice = voices.find(voice => voice.name.includes('Google') || voice.name.includes('Microsoft')) || voices[0];
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }

                speechSynthesis.speak(utterance);
            } else {
                alert('Text-to-speech is not supported in your browser.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if ('speechSynthesis' in window) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                });
            }

            init();
        });
    </script>
</body>
</html>